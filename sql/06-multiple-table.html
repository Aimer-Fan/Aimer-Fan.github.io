<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>多表查询 | AimerFan</title><meta name="description" content="aimer fan's blog repo.">
    <link rel="modulepreload" href="/assets/app.cbf35e07.js"><link rel="modulepreload" href="/assets/06-multiple-table.html.a0377bf3.js"><link rel="modulepreload" href="/assets/06-multiple-table.html.c304e491.js"><link rel="prefetch" href="/assets/index.html.1e88ebbb.js"><link rel="prefetch" href="/assets/index.html.cedfaa0c.js"><link rel="prefetch" href="/assets/Git_GitHub.html.1ee39485.js"><link rel="prefetch" href="/assets/index.html.9cdccac4.js"><link rel="prefetch" href="/assets/index.html.f6641bb3.js"><link rel="prefetch" href="/assets/index.html.8690e658.js"><link rel="prefetch" href="/assets/index.html.4e6e5c05.js"><link rel="prefetch" href="/assets/brew-change-origin.html.836badd5.js"><link rel="prefetch" href="/assets/package-manager.html.1b1c9b42.js"><link rel="prefetch" href="/assets/package.json.html.4631f4f2.js"><link rel="prefetch" href="/assets/permission.html.153538bb.js"><link rel="prefetch" href="/assets/shadow-socks-r.html.d3305835.js"><link rel="prefetch" href="/assets/v2ray.html.fad86528.js"><link rel="prefetch" href="/assets/shell.html.a9cd359c.js"><link rel="prefetch" href="/assets/01-abstract.html.f0b6a374.js"><link rel="prefetch" href="/assets/02-grammar.html.661b7ff9.js"><link rel="prefetch" href="/assets/03-select.html.aeda8c6e.js"><link rel="prefetch" href="/assets/04-operator.html.475e4f3f.js"><link rel="prefetch" href="/assets/05-order-and-page.html.a3dab98a.js"><link rel="prefetch" href="/assets/index.html.101b2f28.js"><link rel="prefetch" href="/assets/tapable.html.faa36181.js"><link rel="prefetch" href="/assets/vim.html.99ce84fd.js"><link rel="prefetch" href="/assets/cache.html.615fd64f.js"><link rel="prefetch" href="/assets/cross-origin-resource-sharing.html.f46eac43.js"><link rel="prefetch" href="/assets/cross-origin.html.b18fe09e.js"><link rel="prefetch" href="/assets/download-file.html.d2e313ab.js"><link rel="prefetch" href="/assets/gcc.html.222e57c3.js"><link rel="prefetch" href="/assets/gzip.html.91dd2ff1.js"><link rel="prefetch" href="/assets/qiankun.html.a5d58a01.js"><link rel="prefetch" href="/assets/regexp.html.215d01f7.js"><link rel="prefetch" href="/assets/vue3-reactivity.html.bcb7e472.js"><link rel="prefetch" href="/assets/index.html.e7560b41.js"><link rel="prefetch" href="/assets/404.html.265028f6.js"><link rel="prefetch" href="/assets/index.html.dae261ee.js"><link rel="prefetch" href="/assets/index.html.221a0ddc.js"><link rel="prefetch" href="/assets/Git_GitHub.html.b71f641d.js"><link rel="prefetch" href="/assets/index.html.a219482e.js"><link rel="prefetch" href="/assets/index.html.399c02c1.js"><link rel="prefetch" href="/assets/index.html.a8bb5dbf.js"><link rel="prefetch" href="/assets/index.html.737f5985.js"><link rel="prefetch" href="/assets/brew-change-origin.html.85494073.js"><link rel="prefetch" href="/assets/package-manager.html.430b6d12.js"><link rel="prefetch" href="/assets/package.json.html.70aa6e0f.js"><link rel="prefetch" href="/assets/permission.html.c3bfacf6.js"><link rel="prefetch" href="/assets/shadow-socks-r.html.4d231b0f.js"><link rel="prefetch" href="/assets/v2ray.html.ce34de8f.js"><link rel="prefetch" href="/assets/shell.html.8bcf8348.js"><link rel="prefetch" href="/assets/01-abstract.html.9f66f3d0.js"><link rel="prefetch" href="/assets/02-grammar.html.9fe43eef.js"><link rel="prefetch" href="/assets/03-select.html.1deb7dbb.js"><link rel="prefetch" href="/assets/04-operator.html.fb89566a.js"><link rel="prefetch" href="/assets/05-order-and-page.html.ffce7199.js"><link rel="prefetch" href="/assets/index.html.0a219270.js"><link rel="prefetch" href="/assets/tapable.html.c39dfe04.js"><link rel="prefetch" href="/assets/vim.html.e448d7cd.js"><link rel="prefetch" href="/assets/cache.html.83b1f755.js"><link rel="prefetch" href="/assets/cross-origin-resource-sharing.html.f5fa5b30.js"><link rel="prefetch" href="/assets/cross-origin.html.4032a9a4.js"><link rel="prefetch" href="/assets/download-file.html.186265ce.js"><link rel="prefetch" href="/assets/gcc.html.ee8d081b.js"><link rel="prefetch" href="/assets/gzip.html.9eb183a9.js"><link rel="prefetch" href="/assets/qiankun.html.ab499129.js"><link rel="prefetch" href="/assets/regexp.html.80ece7c3.js"><link rel="prefetch" href="/assets/vue3-reactivity.html.d546a9b9.js"><link rel="prefetch" href="/assets/index.html.5b0e47b3.js"><link rel="prefetch" href="/assets/404.html.ea6eaeaa.js"><link rel="prefetch" href="/assets/404.4d66fe86.js"><link rel="prefetch" href="/assets/Layout.a4a5a9b1.js">
    <link rel="stylesheet" href="/assets/style.acf36ec1.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/background.png" alt="AimerFan"><span class="site-name can-hide">AimerFan</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/web/gcc" class="" aria-label="Web前端"><!--[--><!--]--> Web前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/sql/01-abstract" class="" aria-label="SQL"><!--[--><!--]--> SQL <!--[--><!--]--></a></div><div class="navbar-item"><a href="/tools/vim" class="" aria-label="工具库"><!--[--><!--]--> 工具库 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/drafts/permission" class="" aria-label="草稿箱"><!--[--><!--]--> 草稿箱 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/todo" class="" aria-label="TODO"><!--[--><!--]--> TODO <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/web/gcc" class="" aria-label="Web前端"><!--[--><!--]--> Web前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/sql/01-abstract" class="" aria-label="SQL"><!--[--><!--]--> SQL <!--[--><!--]--></a></div><div class="navbar-item"><a href="/tools/vim" class="" aria-label="工具库"><!--[--><!--]--> 工具库 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/drafts/permission" class="" aria-label="草稿箱"><!--[--><!--]--> 草稿箱 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/todo" class="" aria-label="TODO"><!--[--><!--]--> TODO <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/sql/01-abstract.html" class="sidebar-item sidebar-heading" aria-label="SQL 概述"><!--[--><!--]--> SQL 概述 <!--[--><!--]--></a><!----></li><li><a href="/sql/02-grammar.html" class="sidebar-item sidebar-heading" aria-label="SQL语言的规则和规范"><!--[--><!--]--> SQL语言的规则和规范 <!--[--><!--]--></a><!----></li><li><a href="/sql/03-select.html" class="sidebar-item sidebar-heading" aria-label="基本的 SELECT 语句"><!--[--><!--]--> 基本的 SELECT 语句 <!--[--><!--]--></a><!----></li><li><a href="/sql/04-operator.html" class="sidebar-item sidebar-heading" aria-label="运算符"><!--[--><!--]--> 运算符 <!--[--><!--]--></a><!----></li><li><a href="/sql/05-order-and-page.html" class="sidebar-item sidebar-heading" aria-label="排序与分页"><!--[--><!--]--> 排序与分页 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="多表查询"><!--[--><!--]--> 多表查询 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/sql/06-multiple-table.html#笛卡尔积-交叉连接" class="router-link-active router-link-exact-active sidebar-item" aria-label="笛卡尔积（交叉连接）"><!--[--><!--]--> 笛卡尔积（交叉连接） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html#多表查询分类" class="router-link-active router-link-exact-active sidebar-item" aria-label="多表查询分类"><!--[--><!--]--> 多表查询分类 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/sql/06-multiple-table.html#等值连接" class="router-link-active router-link-exact-active sidebar-item" aria-label="等值连接"><!--[--><!--]--> 等值连接 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html#非等值连接" class="router-link-active router-link-exact-active sidebar-item" aria-label="非等值连接"><!--[--><!--]--> 非等值连接 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html#自连接" class="router-link-active router-link-exact-active sidebar-item" aria-label="自连接"><!--[--><!--]--> 自连接 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html#内连接和外连接" class="router-link-active router-link-exact-active sidebar-item" aria-label="内连接和外连接"><!--[--><!--]--> 内连接和外连接 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/sql/06-multiple-table.html#sql99语法实现多表查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="SQL99语法实现多表查询"><!--[--><!--]--> SQL99语法实现多表查询 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/sql/06-multiple-table.html#基本语法" class="router-link-active router-link-exact-active sidebar-item" aria-label="基本语法"><!--[--><!--]--> 基本语法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html#内连接-inner-join-的实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="内连接(INNER JOIN)的实现"><!--[--><!--]--> 内连接(INNER JOIN)的实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html#外连接-outer-join-的实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="外连接(OUTER JOIN)的实现"><!--[--><!--]--> 外连接(OUTER JOIN)的实现 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/sql/06-multiple-table.html#union的使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="UNION的使用"><!--[--><!--]--> UNION的使用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html#sql-join-的类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="SQL JOIN 的类型"><!--[--><!--]--> SQL JOIN 的类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html#sql99语法新特性" class="router-link-active router-link-exact-active sidebar-item" aria-label="SQL99语法新特性"><!--[--><!--]--> SQL99语法新特性 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/sql/06-multiple-table.html#自然连接" class="router-link-active router-link-exact-active sidebar-item" aria-label="自然连接"><!--[--><!--]--> 自然连接 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/sql/06-multiple-table.html#using-连接n个表" class="router-link-active router-link-exact-active sidebar-item" aria-label="USING 连接n个表"><!--[--><!--]--> USING 连接n个表 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/sql/06-multiple-table.html#小结" class="router-link-active router-link-exact-active sidebar-item" aria-label="小结"><!--[--><!--]--> 小结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="多表查询" tabindex="-1"><a class="header-anchor" href="#多表查询" aria-hidden="true">#</a> 多表查询</h1><p>多表查询，也称为关联查询，指两个或更多个表一起完成查询操作。 前提条件:这些一起查询的表之间是有关系的(一对一、一对多)，它们之间一定是有关联字段，这个关联字段可能建立了外键，也可能没有建立外键。</p><h2 id="笛卡尔积-交叉连接" tabindex="-1"><a class="header-anchor" href="#笛卡尔积-交叉连接" aria-hidden="true">#</a> 笛卡尔积（交叉连接）</h2><p>笛卡尔乘积是一个数学运算。假设我有两个集合 X 和 Y，那么 X 和 Y 的笛卡尔积就是 X 和 Y 的所有可能组合，也就是第一个对象来自于 X，第二个对象来自于 Y 的所有可能。组合的个数即为两个集合中元素个数的乘积数。</p><p><img src="/assets/sql中的笛卡尔积.ccf4e18c.png" alt=""></p><p>SQL92中，笛卡尔积也称为 交叉连接 ，英文是 CROSS JOIN 。在 SQL99 中也是使用 CROSS JOIN表示交叉连接。它的作用就是可以把任意表进行连接，即使这两张表不相关。在MySQL中如下情况会出现笛卡尔积:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span>department_name <span class="token keyword">FROM</span> employees<span class="token punctuation">,</span>departments<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span>department_name <span class="token keyword">FROM</span> employees <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> departments<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span>department_name <span class="token keyword">FROM</span> employees <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> departments<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span>department_name <span class="token keyword">FROM</span> employees <span class="token keyword">JOIN</span> departments<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>笛卡尔积的错误会在下面条件产生：</p><ul><li>省略多个表的连接条件(或关联条件)</li><li>连接条件(或关联条件)无效</li><li>所有表中的所有行互相连接</li></ul><p>为了避免笛卡尔积， 可以在 WHERE 加入有效的连接条件。加入连接条件后，查询语法:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 案例:查询员工的姓名及其部门名称</span>
<span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span> department_name
<span class="token keyword">FROM</span> employees<span class="token punctuation">,</span> departments
<span class="token keyword">WHERE</span> employees<span class="token punctuation">.</span>department_id <span class="token operator">=</span> departments<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在表中有相同列时，在列名之前加上表名前缀。</p><h2 id="多表查询分类" tabindex="-1"><a class="header-anchor" href="#多表查询分类" aria-hidden="true">#</a> 多表查询分类</h2><h3 id="等值连接" tabindex="-1"><a class="header-anchor" href="#等值连接" aria-hidden="true">#</a> 等值连接</h3><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employees<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span> employees<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>
       employees<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span> departments<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span>
       departments<span class="token punctuation">.</span>location_id
<span class="token keyword">FROM</span>   employees<span class="token punctuation">,</span> departments
<span class="token keyword">WHERE</span>  employees<span class="token punctuation">.</span>department_id <span class="token operator">=</span> departments<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-plain ext-plain line-numbers-mode"><pre class="language-plain"><code>+-------------+-------------+---------------+---------------+-------------+
| employee_id | last_name   | department_id | department_id | location_id |
+-------------+-------------+---------------+---------------+-------------+
|         103 | Hunold      |            60 |            60 |        1400 |
|         104 | Ernst       |            60 |            60 |        1400 |
|         105 | Austin      |            60 |            60 |        1400 |
|         106 | Pataballa   |            60 |            60 |        1400 |
|         107 | Lorentz     |            60 |            60 |        1400 |
|         120 | Weiss       |            50 |            50 |        1500 |
|         121 | Fripp       |            50 |            50 |        1500 |
|         122 | Kaufling    |            50 |            50 |        1500 |
|         123 | Vollman     |            50 |            50 |        1500 |
|         124 | Mourgos     |            50 |            50 |        1500 |
|         125 | Nayer       |            50 |            50 |        1500 |
+-------------+-------------+---------------+---------------+-------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>区分重复的列名</li></ol><ul><li>多个表中有相同列时，必须在列名之前加上表名前缀。</li><li>在不同表中具有相同列名的列可以用表名加以区分。</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employees<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span> departments<span class="token punctuation">.</span>department_name<span class="token punctuation">,</span>employees<span class="token punctuation">.</span>department_id
<span class="token keyword">FROM</span> employees<span class="token punctuation">,</span> departments
<span class="token keyword">WHERE</span> employees<span class="token punctuation">.</span>department_id <span class="token operator">=</span> departments<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>表的别名</li></ol><ul><li>使用别名可以简化查询。</li><li>列名前使用表名前缀可以提高查询效率。</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span> e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span>
       d<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span> d<span class="token punctuation">.</span>location_id
<span class="token keyword">FROM</span>   employees e <span class="token punctuation">,</span> departments d
<span class="token keyword">WHERE</span>  e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>需要注意的是，如果我们使用了表的别名，在查询字段中、过滤条件中就只能使用别名进行代替，不能使用原有的表名，否则就会报错。</p></blockquote><blockquote><p>【强制】对于数据库中表记录的查询和变更，只要涉及多个表，都需要在列名前加表的别名(或表名)进行限定。</p><p>说明:对多表进行查询记录、更新记录、删除记录时，如果对操作列没有限定表的别名(或表名)，并且操作列在多个表中存在时，就会抛异常。</p><p>正例:select t1.name from table_first as t1, table_second as t2 where t1.id=t2.id;</p><p>反例:在某业务中，由于多表关联查询语句没有加表的别名(或表名)的限制，正常运行两年后，最近在某个表中增加一个同名字段，在预发布环境做数据库变更后，线上查询语句出现出 1052 异常:Column &#39;name&#39; in field list is ambiguous。</p></blockquote><ol start="3"><li>连接多个表</li></ol><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span> d<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span> d<span class="token punctuation">.</span>location_id<span class="token punctuation">,</span> l<span class="token punctuation">.</span>location_id<span class="token punctuation">,</span> l<span class="token punctuation">.</span>city
<span class="token keyword">FROM</span>    employees e<span class="token punctuation">,</span> departments d<span class="token punctuation">,</span> locations l
<span class="token keyword">WHERE</span>   e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id <span class="token operator">AND</span> d<span class="token punctuation">.</span>location_id <span class="token operator">=</span> l<span class="token punctuation">.</span>location_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结:连接n个表,至少需要n-1个连接条件。比如，连接三个表，至少需要两个连接条件。</p><h3 id="非等值连接" tabindex="-1"><a class="header-anchor" href="#非等值连接" aria-hidden="true">#</a> 非等值连接</h3><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- employees表中的列工资应在job_grades表中的最高工资和最低工资之间</span>
<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>salary<span class="token punctuation">,</span> j<span class="token punctuation">.</span>grade_level
<span class="token keyword">FROM</span>   employees e<span class="token punctuation">,</span> job_grades j
<span class="token keyword">WHERE</span>  e<span class="token punctuation">.</span>salary <span class="token operator">BETWEEN</span> j<span class="token punctuation">.</span>lowest_sal <span class="token operator">AND</span> j<span class="token punctuation">.</span>highest_sal<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自连接" tabindex="-1"><a class="header-anchor" href="#自连接" aria-hidden="true">#</a> 自连接</h3><p>table1和table2本质上是同一张表，只是用取别名的方式虚拟成两张表以代表不同的意义。然后两个表再进行内连接，外连接等查询。</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>worker<span class="token punctuation">.</span>last_name <span class="token punctuation">,</span><span class="token string">&#39; works for &#39;</span>
       <span class="token punctuation">,</span> manager<span class="token punctuation">.</span>last_name<span class="token punctuation">)</span>
<span class="token keyword">FROM</span>   employees worker<span class="token punctuation">,</span> employees manager
<span class="token keyword">WHERE</span>  worker<span class="token punctuation">.</span>manager_id <span class="token operator">=</span> manager<span class="token punctuation">.</span>employee_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="内连接和外连接" tabindex="-1"><a class="header-anchor" href="#内连接和外连接" aria-hidden="true">#</a> 内连接和外连接</h3><ul><li>内连接: 合并具有同一列的两个以上的表的行, 结果集中不包含一个表与另一个表不匹配的行。</li><li>外连接: 两个表在连接过程中除了返回满足连接条件的行以外还返回左(或右)表中不满足条件的行，这种连接称为左(或右)外连接。没有匹配的行时,结果表中相应的列为空(NULL)。</li><li>如果是左外连接，则连接条件中左边的表也称为主表，右边的表称为从表。</li><li>如果是右外连接，则连接条件中右边的表也称为主表，左边的表称为从表。</li></ul><p><strong>SQL92:使用(+)创建连接</strong></p><ul><li>在 SQL92 中采用(+)代表从表所在的位置。即左或右外连接中，(+) 表示哪个是从表。</li><li>Oracle 对 SQL92 支持较好，而 MySQL 则不支持 SQL92 的外连接。</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 左外连接</span>
<span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees <span class="token punctuation">,</span>departments
<span class="token keyword">WHERE</span> employees<span class="token punctuation">.</span>department_id <span class="token operator">=</span> departments<span class="token punctuation">.</span>department_id<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 右外连接</span>
<span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees <span class="token punctuation">,</span>departments
<span class="token keyword">WHERE</span> employees<span class="token punctuation">.</span>department_id<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token operator">=</span> departments<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sql99语法实现多表查询" tabindex="-1"><a class="header-anchor" href="#sql99语法实现多表查询" aria-hidden="true">#</a> SQL99语法实现多表查询</h2><h3 id="基本语法" tabindex="-1"><a class="header-anchor" href="#基本语法" aria-hidden="true">#</a> 基本语法</h3><p>使用 JOIN ON 子句创建连接的语法结构：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> table1<span class="token punctuation">.</span><span class="token keyword">column</span><span class="token punctuation">,</span> table2<span class="token punctuation">.</span><span class="token keyword">column</span><span class="token punctuation">,</span>table3<span class="token punctuation">.</span><span class="token keyword">column</span>
<span class="token keyword">FROM</span> table1
<span class="token keyword">JOIN</span> table2 <span class="token keyword">ON</span> table1 和 table2 的连接条件 <span class="token keyword">JOIN</span> table3 <span class="token keyword">ON</span> table2 和 table3 的连接条件
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SQL99 采用的这种嵌套结构非常清爽、层次性更强、可读性更强，即使再多的表进行连接也都清晰 可见。如果你采用 SQL92，可读性就会大打折扣。</p><p>语法说明:</p><ul><li>可以使用 ON 子句指定额外的连接条件。</li><li>这个连接条件是与其它条件分开的。</li><li>ON 子句使语句具有更高的易读性。</li><li>关键字 JOIN、INNER JOIN、CROSS JOIN 的含义是一样的，都表示内连接</li></ul><h3 id="内连接-inner-join-的实现" tabindex="-1"><a class="header-anchor" href="#内连接-inner-join-的实现" aria-hidden="true">#</a> 内连接(INNER JOIN)的实现</h3><p>语法:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 字段列表
<span class="token keyword">FROM</span> A表 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> B表 <span class="token keyword">ON</span> 关联条件
<span class="token keyword">WHERE</span> 等其他子句<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span> e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span>
       d<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span> d<span class="token punctuation">.</span>location_id
<span class="token keyword">FROM</span>   employees e <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span>     <span class="token punctuation">(</span>e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-plain ext-plain line-numbers-mode"><pre class="language-plain"><code>+-------------+-------------+---------------+---------------+-------------+
| employee_id | last_name   | department_id | department_id | location_id |
+-------------+-------------+---------------+---------------+-------------+
|         103 | Hunold      |            60 |            60 |        1400 |
|         104 | Ernst       |            60 |            60 |        1400 |
|         105 | Austin      |            60 |            60 |        1400 |
|         106 | Pataballa   |            60 |            60 |        1400 |
|         107 | Lorentz     |            60 |            60 |        1400 |
|         120 | Weiss       |            50 |            50 |        1500 |
|         121 | Fripp       |            50 |            50 |        1500 |
|         122 | Kaufling    |            50 |            50 |        1500 |
+-------------+-------------+---------------+---------------+-------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="外连接-outer-join-的实现" tabindex="-1"><a class="header-anchor" href="#外连接-outer-join-的实现" aria-hidden="true">#</a> 外连接(OUTER JOIN)的实现</h3><p><strong>左外连接(LEFT OUTER JOIN)</strong></p><p>语法:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 实现查询结果是A</span>
<span class="token keyword">SELECT</span> 字段列表
<span class="token keyword">FROM</span> A表 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> B表 <span class="token keyword">ON</span> 关联条件
<span class="token keyword">WHERE</span> 等其他子句<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>举例:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span> d<span class="token punctuation">.</span>department_name
<span class="token keyword">FROM</span>   employees e
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span>   e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-plain ext-plain line-numbers-mode"><pre class="language-plain"><code>+-------------+---------------+------------------+
| last_name   | department_id | department_name  |
+-------------+---------------+------------------+
| Abel        |            80 | Sales            |
| Hutton      |            80 | Sales            |
| Taylor      |            80 | Sales            |
| Livingston  |            80 | Sales            |
| Grant       |          NULL | NULL             |
| Johnson     |            80 | Sales            |
| Taylor      |            50 | Shipping         |
+-------------+---------------+------------------+
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>右外连接(RIGHT OUTER JOIN)</strong></p><p>语法：</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 实现查询结果是B</span>
<span class="token keyword">SELECT</span> 字段列表
<span class="token keyword">FROM</span> A表 <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> B表 <span class="token keyword">ON</span> 关联条件
<span class="token keyword">WHERE</span> 等其他子句<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>举例:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span> d<span class="token punctuation">.</span>department_name
<span class="token keyword">FROM</span>   employees e
<span class="token keyword">RIGHT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span>    <span class="token punctuation">(</span>e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id<span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-plain ext-plain line-numbers-mode"><pre class="language-plain"><code>+-------------+---------------+----------------------+
| last_name   | department_id | department_name      |
+-------------+---------------+----------------------+
| Urman       |           100 | Finance              |
| Popp        |           100 | Finance              |
| Higgins     |           110 | Accounting           |
| Gietz       |           110 | Accounting           |
| NULL        |          NULL | Treasury             |
| NULL        |          NULL | Corporate Tax        |
| NULL        |          NULL | Control And Credit   |
+-------------+---------------+----------------------+
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>需要注意的是，LEFT JOIN 和 RIGHT JOIN 只存在于 SQL99 及以后的标准中，在 SQL92 中不存在，只能用 (+) 表示。</p></blockquote><p><strong>满外连接(FULL OUTER JOIN)</strong></p><ul><li>满外连接的结果 = 左右表匹配的数据 + 左表没有匹配到的数据 + 右表没有匹配到的数据。</li><li>SQL99是支持满外连接的。使用FULL JOIN 或 FULL OUTER JOIN来实现。</li><li>需要注意的是，MySQL不支持FULL JOIN，但是可以用 LEFT JOIN UNION RIGHT join代替。</li></ul><h2 id="union的使用" tabindex="-1"><a class="header-anchor" href="#union的使用" aria-hidden="true">#</a> UNION的使用</h2><p>合并查询结果利用UNION关键字，可以给出多条SELECT语句，并将它们的结果组合成单个结果集。合并时，两个表对应的列数和数据类型必须相同，并且相互对应。各个SELECT语句之间使用UNION或UNION ALL关键字分隔。</p><p>语法格式:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">column</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> table1
<span class="token keyword">UNION</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span><span class="token punctuation">]</span>
<span class="token keyword">SELECT</span> <span class="token keyword">column</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> table2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>UNION 操作符返回两个查询的结果集的并集，去除重复记录。</li><li>UNION ALL操作符返回两个查询的结果集的并集。对于两个结果集的重复部分，不去重。</li></ul><blockquote><p>注意:执行UNION ALL语句时所需要的资源比UNION语句少。如果明确知道合并数据后的结果数据不存在重复数据，或者不需要去除重复的数据，则尽量使用UNION ALL语句，以提高数据查询的效率。</p></blockquote><p>举例:查询部门编号&gt;90或邮箱包含a的员工信息</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 方式1</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> email <span class="token operator">LIKE</span> <span class="token string">&#39;%a%&#39;</span> <span class="token operator">OR</span> department_id<span class="token operator">&gt;</span><span class="token number">90</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 方式2</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> email <span class="token operator">LIKE</span> <span class="token string">&#39;%a%&#39;</span> <span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> department_id<span class="token operator">&gt;</span><span class="token number">90</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sql-join-的类型" tabindex="-1"><a class="header-anchor" href="#sql-join-的类型" aria-hidden="true">#</a> SQL JOIN 的类型</h2><p><img src="/assets/sql的join类型.20e5c9c1.png" alt=""></p><ul><li>左中图</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 实现A - A∩B</span>
<span class="token keyword">select</span> 字段列表
<span class="token keyword">from</span> A表 <span class="token keyword">left</span> <span class="token keyword">join</span> B表
<span class="token keyword">on</span> 关联条件
<span class="token keyword">where</span> 从表关联字段 <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">and</span> 等其他子句<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>右中图</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 实现A - A∩B</span>
<span class="token keyword">select</span> 字段列表
<span class="token keyword">from</span> A表 <span class="token keyword">left</span> <span class="token keyword">join</span> B表
<span class="token keyword">on</span> 关联条件
<span class="token keyword">where</span> 从表关联字段 <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">and</span> 等其他子句<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>左下图</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 实现查询结果是A∪B #用左外的A，union 右外的B select 字段列表</span>
<span class="token keyword">from</span> A表 <span class="token keyword">left</span> <span class="token keyword">join</span> B表 <span class="token keyword">on</span> 关联条件
<span class="token keyword">where</span> 等其他子句

<span class="token keyword">union</span>

<span class="token keyword">select</span> 字段列表
<span class="token keyword">from</span> A表 <span class="token keyword">right</span> <span class="token keyword">join</span> B表 <span class="token keyword">on</span> 关联条件
<span class="token keyword">where</span> 等其他子句<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>右下图</li></ul><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 实现A∪B- A∩B 或 (A- A∩B)∪(B-A∩B)</span>
<span class="token comment">-- 使用左外的 (A - A∩B) union 右外的(B - A∩B) select 字段列表</span>
<span class="token keyword">from</span> A表 <span class="token keyword">left</span> <span class="token keyword">join</span> B表
<span class="token keyword">on</span> 关联条件
<span class="token keyword">where</span> 从表关联字段 <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">and</span> 等其他子句

<span class="token keyword">union</span>

<span class="token keyword">select</span> 字段列表
<span class="token keyword">from</span> A表 <span class="token keyword">right</span> <span class="token keyword">join</span> B表
<span class="token keyword">on</span> 关联条件
<span class="token keyword">where</span> 从表关联字段 <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">and</span> 等其他子句
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sql99语法新特性" tabindex="-1"><a class="header-anchor" href="#sql99语法新特性" aria-hidden="true">#</a> SQL99语法新特性</h2><h3 id="自然连接" tabindex="-1"><a class="header-anchor" href="#自然连接" aria-hidden="true">#</a> 自然连接</h3><p>SQL99在SQL92的基础上提供了一些特殊语法，比如 NATURAL JOIN 用来表示自然连接。我们可以把自然连接理解为 SQL92 中的等值连接。它会帮你自动查询两张连接表中所有相同的字段 ，然后进行等值连接。</p><p>在SQL92标准中:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span></span>
<span class="token operator">AND</span> e<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>manager_id<span class="token punctuation">`</span></span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>manager_id<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 SQL99 中你可以写成:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">NATURAL</span> <span class="token keyword">JOIN</span> departments d<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="using-连接n个表" tabindex="-1"><a class="header-anchor" href="#using-连接n个表" aria-hidden="true">#</a> USING 连接n个表</h3><p>当我们进行连接的时候，SQL99还支持使用 USING 指定数据表里的同名字段进行等值连接。但是只能配合JOIN一起使用。比如:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">JOIN</span> departments d
<span class="token keyword">USING</span> <span class="token punctuation">(</span>department_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你能看出与自然连接 NATURAL JOIN 不同的是，USING 指定了具体的相同的字段名称，你需要在 USING 的括号()中填入要指定的同名字段。同时使用 JOIN...USING 可以简化 JOIN ON 的等值连接。它与下面的 SQL 查询结果是相同的:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token punctuation">,</span>departments d
<span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h2><p>表连接的约束条件可以有三种方式:WHERE, ON, USING</p><ul><li>WHERE:适用于所有关联查询</li><li>ON :只能和JOIN一起使用，只能写关联条件。虽然关联条件可以并到WHERE中和其他条件一起写，但分开写可读性更好。</li><li>USING:只能和JOIN一起使用，而且要求 两个 关联字段在关联表中名称一致，而且只能表示关联字段值相等</li></ul><p>注意:</p><p>我们要控制连接表的数量。多表连接就相当于嵌套 for 循环一样，非常消耗资源，会让 SQL 查询性能下降得很严重，因此不要连接不必要的表。在许多 DBMS 中，也都会有最大连接表的限制。</p><blockquote><p>强制】超过三个表禁止 join。需要 join 的字段，数据类型保持绝对一致;多表关联查询时，保证被关联的字段需要有索引。</p><p>说明:即使双表 join 也要注意表索引、SQL 性能。</p><p>来源:阿里巴巴《Java开发手册》</p></blockquote></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1261105760@qq.com">AimerFan</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/sql/05-order-and-page.html" class="" aria-label="排序与分页"><!--[--><!--]--> 排序与分页 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.cbf35e07.js" defer></script>
  </body>
</html>
