# HTTP缓存

HTTP缓存又称硬盘缓存（dask cache）。当客户端（浏览器）和服务端通信时，并不需要每次都下载最新的资源，服务端可以通过响应头的某些字段控制客户端是否需要重新向服务端请求资源内容。

HTTP缓存分为强缓存和协商缓存两个阶段：

## 强制缓存

浏览器向服务器请求资源的时候，服务器会告诉浏览器：

我给你返回的资源你需要自己保存下，在某个时刻之前，你都直接用我刚刚发给你的那份文件，不需要再问我要数据了。

浏览器拿到这个时间之后，在每次和服务器建立连接发送请求之前，都会看下这个缓存的文件是否过期了，如果没有过期，那就不询问服务器，直接使用硬盘中的数据。此时的http状态码为200。

与强制缓存有关的 http 头字段为：

| header名                | 可选值                                                       | 优先级 |
| ----------------------- | :----------------------------------------------------------- | ------ |
| Pragma(HTTP/1.0)        | no-cache：不需要强制缓存，但每次需要进行协商缓存             | 高     |
| Cache-Control(HTTP/1.1) | no-cache：不需要强制缓存，但每次需要进行协商缓存；no-store：不需要缓存，每次有请求服务器；max-age：缓存时长，单位秒；public：表示该资源是公开的；private：表示该资源是私有的；must-revalidate：客户端可以缓存资源，但是每次都需要向服务端询问； | 中     |
| Expries(HTTP/1.0)       | GMT时间                                                      | 低     |

## 协商缓存

当强制缓存过期时，浏览器仍然不会立即发送请求询问服务器最新数据，此时会进入协商缓存阶段。这个阶段用来抢救下之前过期的强制缓存，看下过期的资源还能不能继续使用。这时浏览器会在发送请求时携带一些描述性的字段，标识下这个资源的缓存状态。服务器可以决定时继续使用原来的资源，还是重新发一份新的给浏览器。

服务器看了下资源并没有变更，那么它会返回 304 状态码，告诉浏览器可以继续使用缓存中的数据。如果资源变更了，那么服务器会返回新的资源内容，并且返回 200 状态码。

与协商缓存有关的 http 头字段为：

| header名                                  | 可选值  | 优先级 |
| ----------------------------------------- | ------- | ------ |
| ETag/If-Not-Match(HTTP/1.1)               | HASH值  | 高     |
| Last-Modified/If-Modified-Since(HTTP/1.0) | GMT时间 | 低     |

